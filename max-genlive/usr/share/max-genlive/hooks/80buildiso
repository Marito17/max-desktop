
_echo "Copiando archivos isolinux..."

cp $GENLIVE/isolinux/* $CDRW/isolinux/ || _exit "No se puede sobreescribir isolinux"

_echo "Copiando preseed"
rm -f $CDRW/preseed/*
cp $GENLIVE/preseed/* $CDRW/preseed/ || _exit "No se puede sobreescribir preseed"

printf "%s - i386 (%s)" "$TITLE" "$created" > $CDRW/.disk/info
printf "http://max.educa.madrid.org:8000/MaX40/NotasPublicacion" > $CDRW/.disk/release_notes_url

cat << EOF > $CDRW/README.diskdefines
#define DISKNAME  $TITLE - Build i386 $created
#define TYPE  binary
#define TYPEbinary  1
#define ARCH  i386
#define ARCHi386  1
#define DISKNUM  1
#define DISKNUM1  1
#define TOTALNUM  0
#define TOTALNUM0  1
EOF

_echo "Borrando wuby (instalador para windows)"
rm -rf $CDRW/*exe
rm -rf $CDRW/*inf
rm -rf $CDRW/pics/

# aÃ±adir software portable del paquete max-win32-apps
if [ -d $GENLIVE/win32aps ]; then
  _echo "Copiando max-win32-apps ..."
  cp -ra $GENLIVE/win32aps/* $CDRW/
fi

_echo "Generando md5sum de archivos de dentro del DVD..."
# FIXME no hay que hacer el md5 de boot.cat o isolinux.bin
(cd $CDRW && find . -type f -print0 |xargs -0 md5sum > md5sum.txt)

_echo "Generando ${IMAGE_NAME}-${stamp}.iso"

mkisofs -r -V "$TITLE" -cache-inodes -J -l -b isolinux/isolinux.bin \
     -c isolinux/boot.cat -no-emul-boot -boot-load-size 4 \
     -boot-info-table -o ${IMAGE_NAME}-${stamp}.iso $CDRW/ || _exit "Error generando la imagen ISO"

_echo "Generando md5 del DVD"
md5sum ${IMAGE_NAME}-${stamp}.iso > ${IMAGE_NAME}-${stamp}.iso.md5 || _exit "Error generando el md5"

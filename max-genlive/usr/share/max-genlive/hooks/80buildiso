
stamp=$(date '+%Y%m%d_%H%M')
_echo "Copiando archivos isolinux..."

cp $GENLIVE/isolinux/* $CDRW/isolinux/ || _exit "No se puede sobreescribir isolinux"

_echo "Copiando preseed"
rm -f $CDRW/preseed/*
cp $GENLIVE/preseed/* $CDRW/preseed/ || _exit "No se puede sobreescribir preseed"


_echo "Generando md5sum de archivos de dentro del DVD..."
(cd $CDRW && find . -type f -print0 |xargs -0 md5sum > md5sum.txt)

_echo "Generando ${IMAGE_NAME}-${stamp}.iso"

mkisofs -r -V "$IMAGE_NAME" -cache-inodes -J -l -b isolinux/isolinux.bin \
     -c isolinux/boot.cat -no-emul-boot -boot-load-size 4 \
     -boot-info-table -o ${IMAGE_NAME}-${stamp}.iso $CDRW/ || _exit "Error generando la imagen ISO"

_echo "Generando md5 del DVD"
md5sum ${IMAGE_NAME}-${stamp}.iso > ${IMAGE_NAME}-${stamp}.iso.md5 || _exit "Error generando el md5"

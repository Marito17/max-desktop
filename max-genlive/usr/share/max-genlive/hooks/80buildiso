
stamp=$(date '+%Y%m%d_%H%M')
created=$(date '+%Y%m%d')
_echo "Copiando archivos isolinux..."

cp $GENLIVE/isolinux/* $CDRW/isolinux/ || _exit "No se puede sobreescribir isolinux"

_echo "Copiando preseed"
rm -f $CDRW/preseed/*
cp $GENLIVE/preseed/* $CDRW/preseed/ || _exit "No se puede sobreescribir preseed"

printf "%s - i386 (%s)" "$TITLE" "$created" > $CDRW/.disk/info
printf "http://max.educa.madrid.org:8000/MaX40/NotasPublicacion" > $CDRW/.disk/release_notes_url


_echo "Borrando wuby (instalador para windows)"
rm -rf $CDRW/*exe
rm -rf $CDRW/*inf
rm -rf $CDRW/pics/

# FIXME este es buen sitio para aÃ±adir software portable o una pagina html de bienvenida.

_echo "Generando md5sum de archivos de dentro del DVD..."
# FIXME no hay que hacer el md5 de boot.cat o isolinux.bin
(cd $CDRW && find . -type f -print0 |xargs -0 md5sum > md5sum.txt)

_echo "Generando ${IMAGE_NAME}-${stamp}.iso"

mkisofs -r -V "$IMAGE_NAME" -cache-inodes -J -l -b isolinux/isolinux.bin \
     -c isolinux/boot.cat -no-emul-boot -boot-load-size 4 \
     -boot-info-table -o ${IMAGE_NAME}-${stamp}.iso $CDRW/ || _exit "Error generando la imagen ISO"

_echo "Generando md5 del DVD"
md5sum ${IMAGE_NAME}-${stamp}.iso > ${IMAGE_NAME}-${stamp}.iso.md5 || _exit "Error generando el md5"


_echo "Configurando DNS del chroot y nuevo sources.list"

cat /etc/resolv.conf > $CHROOT/etc/resolv.conf

if [ $LOCAL_MIRROR ]; then
     _echo " ****** sources.list ***** Usando mirror local => $MIRROR"
     cat << EOF > $CHROOT/etc/apt/sources.list
deb http://$MIRROR/ubuntu ${DISTRO} main universe multiverse restricted
deb http://$MIRROR/ubuntu ${DISTRO}-updates main universe multiverse restricted
deb http://$MIRROR/ubuntu ${DISTRO}-security main universe multiverse restricted

deb http://$MIRROR/max70 max main

EOF
else
     cp $GENLIVE/sources.list $CHROOT/etc/apt/
fi

# blacklist packages
rm -f $CHROOT/etc/apt/preferences.d/20_no_max_recom.pref

cat << EOF > /tmp/noextraubuntu
Section: misc
Priority: optional
Standards-Version: 3.8.4

Package: noextraubuntu
Version: 0.1
Provides: $(echo $BLACKLIST_PKGS | sed -e 's/ /, /g')
Replaces: $(echo $BLACKLIST_PKGS | sed -e 's/ /, /g')
Conflicts: $(echo $BLACKLIST_PKGS | sed -e 's/ /, /g')
Architecture: all
Description: Provides some not needed Ubuntu packages

EOF

#OLDDIR=`pwd`
#cd /tmp
#equivs-build /tmp/noextraubuntu
#mv /tmp/noextraubuntu*deb $CHROOT/
#cd $OLDDIR
rm -f /tmp/noextraubuntu

#chroot $CHROOT/ << EOF || _exit "Error instalando noextraubuntu"
#export LC_ALL=C
#export LC_MESSAGES=C
#export DEBCONF_FRONTEND="noninteractive"
#export DEBIAN_FRONTEND="noninteractive"
#dpkg -i /noextraubuntu*deb
#EOF
#rm -f $CHROOT/noextraubuntu*deb


mount --bind /proc $CHROOT/proc
mount --bind /sys   $CHROOT/sys

# se necesita para ebeam-driver (luego se borra)
touch $CHROOT/etc/X11/xorg.conf


_echo "Configurando DEBCONF: licencia JAVA... zona horaria y firmware"
chroot $CHROOT debconf-set-selections << EOF || _exit "No se ha podido aceptar la licencia JAVA"
sun-java5-bin   shared/accepted-sun-dlj-v1-1    boolean true
sun-java5-jdk   shared/accepted-sun-dlj-v1-1    boolean true
sun-java5-jre   shared/accepted-sun-dlj-v1-1    boolean true
sun-java6-bin   shared/accepted-sun-dlj-v1-1    boolean true
sun-java6-jre   shared/accepted-sun-dlj-v1-1    boolean true
sun-java6-jdk   shared/accepted-sun-dlj-v1-1    boolean true
tzdata  tzdata/Areas    select  Europe
tzdata  tzdata/Zones/Europe     select  Madrid
b43-fwcutter	b43-fwcutter/cut_firmware	boolean	true
ttf-mscorefonts-installer	msttcorefonts/accepted-mscorefonts-eula	boolean	true
ttf-mscorefonts-installer	msttcorefonts/present-mscorefonts-eula	note
EOF

echo "Europe/Madrid" > $CHROOT/etc/timezone

chroot $CHROOT/ << EOF || _exit "Error configurando zona horaria Europe/Madrid"
export LC_ALL=C
export LC_MESSAGES=C
export DEBCONF_FRONTEND="noninteractive"
export DEBIAN_FRONTEND="noninteractive"
dpkg-reconfigure tzdata
EOF

#xserver-xorg    xserver-xorg/config/inputdevice/keyboard/layout string es
#xserver-xorg    xserver-xorg/config/inputdevice/keyboard/model  string pc105
# not work
#console-setup	console-setup/variant	select	Spain
#console-setup	console-setup/layoutcode	string	es
#console-setup	console-setup/charmap	select	UTF-8
#console-setup	console-setup/fontsize-text	select	16
#console-setup	console-setup/layout	select	Spain
#console-setup	console-setup/variantcode	string	
#console-setup	console-setup/codesetcode	string	Uni1
#console-setup	console-setup/modelcode	string	pc105
#console-setup	console-setup/altgr	select	No AltGr key
#console-setup	console-setup/ttys	string	/dev/tty[1-6]
#console-setup	console-setup/model	select	Generic 105-key (Intl) PC
#console-setup	console-setup/fontsize-fb	select	16
#console-setup	console-setup/fontface	select	Fixed
#console-setup	console-setup/fontsize	string	16
#EOF

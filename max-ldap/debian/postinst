#!/bin/sh



if [ "$1" = "configure" ]; then

   [ -e /etc/init.d/max-ldap ] && rm -f /etc/init.d/max-ldap


    # call update GRUB to create extlinux conf
    if which update-grub > /dev/null ; then
        update-grub
    fi

    if [ -f /etc/ldap.conf ] && [ "$(grep -c ^rootbinddn /etc/ldap.conf)" != "0" ]; then
      # disable rootbinddn
      sed -i -e 's/rootbinddn/#rootbinddn/g' /etc/ldap.conf
      rm -f /etc/ldap.secret
    fi


    if ! grep -q "# max-ldap" /etc/ssh/sshd_config; then
        cat << EOF >> /etc/ssh/sshd_config

# max-ldap
# Al estar este equipo unido al dominio,
# s√≥lo se permite el acceso a usuarios del grupo 'Instaladores'
# (perfil Administrador en max-control)
# no pueden acceder ni usuarios locales, ni profesores ni Coordinadores TIC

AllowGroups Instaladores
EOF
        restart ssh || true
    fi

fi


exit 0
